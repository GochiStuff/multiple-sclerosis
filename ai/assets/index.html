<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MRI Multiple Sclerosis Classifier</title>
  <style>
    /* ---------- Design tokens ---------- */
    :root{
      --page-padding: 20px;
      --gutter: 24px;
      --radius: 10px;
      --accent: #0f59d6;
      --muted: #55606a;
      --bg-start: #f6f9ff;
      --bg-end: #eef6ff;
      --content-max: 1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0}
    body{
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: linear-gradient(180deg,var(--bg-start), var(--bg-end));
      color:#071233;
      padding:var(--page-padding);
      display:flex;
      justify-content:center;
    }

    /* ---------- Page wrapper ---------- */
    .wrap{
      width:100%;
      max-width:var(--content-max);
      display:flex;
      flex-direction:column;
      gap:18px;
    }

    /* ---------- Header ---------- */
    header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:14px 18px;
    }
    .brand {
      display:flex;
      align-items:center;
      gap:14px;
    }
    .logo {
      width:56px;
      height:56px;
      border-radius:12px;
      background: linear-gradient(135deg,var(--accent), #2aa7ff);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-weight:800;
      font-size:20px;
      box-shadow: 0 10px 28px rgba(15,89,214,0.12);
      flex-shrink:0;
    }
    .brand h1 {
      margin:0;
      font-size:26px;
      line-height:1;
    }
    .brand p {
      margin:2px 0 0 0;
      font-size:13px;
      color:var(--muted);
    }
    .meta {
      text-align:right;
      color:var(--muted);
      font-size:13px;
      min-width:200px;
    }

    /* ---------- Main two-column layout ---------- */
    main {
      display:flex;
      gap:var(--gutter);
      align-items:stretch;
      height: calc(100vh - 170px); /* leave room for header & padding */
    }

    /* Left column (image) */
    .left {
      flex:1.15;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:10px;
    }

    .dropzone {
      width:100%;
      height:100%;
      min-height:420px;
      border-radius:var(--radius);
      padding:20px;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
      justify-content:flex-start;
      border:2px dashed rgba(6,18,43,0.06);
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.95));
      transition: box-shadow .16s ease, border-color .16s ease, background .16s ease;
      cursor:pointer;
    }
    .dropzone.drag {
      border-color:var(--accent);
      box-shadow: 0 18px 48px rgba(15,89,214,0.06);
      background: rgba(15,89,214,0.02);
    }

    .dropzone .top {
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .dropzone .instructions {
      flex:1;
      min-width:0;
    }
    .dropzone p {
      margin:0;
      font-weight:700;
      font-size:20px;
      color:#07305a;
    }
    .dropzone small {
      display:block;
      margin-top:6px;
      color:var(--muted);
      font-size:14px;
    }

    #preview {
      width:100%;
      max-width:920px;
      max-height:calc(100% - 90px);
      border-radius:8px;
      object-fit:contain;
      border:1px solid rgba(6,18,43,0.04);
      background:white;
      box-shadow: 0 10px 28px rgba(6,18,43,0.03);
      display:block;
      margin-top:10px;
    }

    /* Right column (prediction) */
    .right {
      width:420px;
      min-width:280px;
      display:flex;
      flex-direction:column;
      gap:16px;
      padding:10px 6px;
      align-items:flex-start;
      justify-content:flex-start;
    }

    .section-title {
      font-size:14px;
      color:var(--muted);
      margin:0;
    }
    .outcome {
      font-size:42px;
      font-weight:800;
      margin:6px 0 0 0;
      color:#071233;
      line-height:1;
    }

    .confidence-row {
      width:100%;
      display:flex;
      align-items:center;
      gap:14px;
      margin-top:12px;
    }
    .confidence-col {
      min-width:140px;
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:4px;
    }
    .confidence-num {
      font-size:28px;
      font-weight:800;
      color:var(--accent);
    }
    .progress {
      flex:1;
      height:18px;
      background:#eaf4ff;
      border-radius:999px;
      overflow:hidden;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.5);
    }
    .progress > i {
      display:block;
      height:100%;
      width:0%;
      background: linear-gradient(90deg,var(--accent), #2aa7ff);
      transition: width .9s cubic-bezier(.2,.9,.2,1);
    }

    .notes {
      margin-top:12px;
      font-size:15px;
      color:var(--muted);
      line-height:1.4;
    }

    .actions {
      display:flex;
      gap:12px;
      width:100%;
      margin-top:8px;
    }
    .btn {
      padding:12px 16px;
      border-radius:10px;
      border:0;
      font-weight:700;
      font-size:15px;
      cursor:pointer;
    }
    .btn.primary {
      background:var(--accent);
      color:white;
      flex:1;
      box-shadow: 0 12px 30px rgba(15,89,214,0.10);
    }
    .btn.ghost {
      background:transparent;
      border:2px solid rgba(6,18,43,0.06);
      color:var(--muted);
      min-width:140px;
    }
    .btn:disabled { opacity:0.6; cursor:not-allowed; }

    /* Loading overlay */
    .overlay {
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:60;
      background: rgba(2,6,23,0.35);
    }
    .loading {
      display:flex;
      gap:14px;
      align-items:center;
      padding:16px 18px;
      border-radius:12px;
      color:white;
      backdrop-filter: blur(4px);
    }
    .spinner {
      width:52px;
      height:52px;
      border-radius:50%;
      border:6px solid rgba(255,255,255,0.18);
      border-top-color:#fff;
      animation:spin 0.85s linear infinite;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Responsive: stack */
    @media (max-width:1100px){
      main { flex-direction:column; height:auto; gap:18px }
      .right { width:100%; min-width:unset; order:2; }
      .left { order:1; }
      .dropzone { min-height:320px; padding:16px; }
      #preview { max-height:calc(100% - 80px); }
    }

    @media (max-width:560px){
      .brand h1 { font-size:20px; }
      .logo { width:48px; height:48px; }
      .outcome { font-size:34px; }
      .confidence-num { font-size:22px; }
      .dropzone p { font-size:18px; }
      .dropzone small { font-size:13px; }
    }

    /* focus outline for accessibility */
    .dropzone:focus { outline: 3px solid rgba(15,89,214,0.12); outline-offset:4px; }
  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="MRI MS Classifier">
    <header aria-label="Header">
      <div class="brand">
        <div class="logo" aria-hidden="true">MS</div>
        <div>
          <h1>MRI Multiple Sclerosis Classifier</h1>
          <p>Automated MRI scan screening — clinical support</p>
        </div>
      </div>
      <div class="meta" aria-hidden="false">
        <div>Model: <strong>ResNet18 v1</strong></div>
        <div style="margin-top:6px">Endpoint: <span id="endpointText">http://127.0.0.1:8000/predict</span></div>
      </div>
    </header>

    <main role="main" aria-label="Main content">
      <!-- LEFT: drag/drop & preview -->
      <section class="left" aria-labelledby="uploadLabel">
        <label id="uploadLabel" class="dropzone" for="fileInput" tabindex="0" aria-describedby="dropDesc">
          <input id="fileInput" type="file" accept="image/*" style="display:none" aria-hidden="true" />
          <div class="top">
            <div class="instructions">
              <p>Drag & drop MRI image here — or click to select</p>
              <small id="dropDesc">PNG / JPG recommended. Prefer 512×512 or higher.</small>
            </div>
            <div style="min-width:96px; text-align:right; color:var(--muted); font-size:13px;">
              <div>Study</div>
              <div style="margin-top:4px; font-weight:700">MS Screening</div>
            </div>
          </div>

          <img id="preview" alt="MRI preview" hidden>
        </label>
      </section>

      <!-- RIGHT: prediction results -->
      <aside class="right" aria-labelledby="resultLabel">
        <div style="width:100%;">
          <div class="section-title" id="resultLabel">Prediction</div>
          <div id="outcome" class="outcome" aria-live="polite">—</div>

          <div class="confidence-row" aria-hidden="false">
            <div class="confidence-col">
              <div class="small">Confidence</div>
              <div id="confidence" class="confidence-num">0%</div>
            </div>
            <div class="progress" aria-hidden="true">
              <i id="progressBar"></i>
            </div>
          </div>

          <div class="notes" id="notes">No analysis yet. Upload an MRI to begin.</div>

          <div class="actions">
            <button id="predictBtn" class="btn primary" onclick="uploadImage()">Predict</button>
            <button id="clearBtn" class="btn ghost" onclick="clearAll()">Clear</button>
          </div>
        </div>
      </aside>
    </main>
  </div>

  <!-- Loading overlay -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="loading" role="status" aria-live="polite">
      <div class="spinner" aria-hidden="true"></div>
      <div>
        <div style="font-weight:800; font-size:18px;">Analyzing MRI — please wait</div>
        <div style="margin-top:6px; color:rgba(255,255,255,0.85); font-size:13px" id="overlayMsg">Uploading & running model inference...</div>
      </div>
    </div>
  </div>

  <script>
    /* ---------- Elements ---------- */
    const fileInput = document.getElementById('fileInput');
    const dropzone = document.querySelector('.dropzone');
    const preview = document.getElementById('preview');
    const predictBtn = document.getElementById('predictBtn');
    const clearBtn = document.getElementById('clearBtn');
    const overlay = document.getElementById('overlay');
    const overlayMsg = document.getElementById('overlayMsg');

    const outcomeEl = document.getElementById('outcome');
    const confidenceEl = document.getElementById('confidence');
    const progressBar = document.getElementById('progressBar');
    const notesEl = document.getElementById('notes');

    let currentFile = null;

    /* ---------- Drag & drop interactions ---------- */
    ['dragenter','dragover'].forEach(ev => {
      dropzone.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); dropzone.classList.add('drag'); });
    });
    ['dragleave','drop'].forEach(ev => {
      dropzone.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); dropzone.classList.remove('drag'); });
    });
    dropzone.addEventListener('drop', e => {
      const f = e.dataTransfer.files && e.dataTransfer.files[0];
      if (f) handleFileSelection(f);
    });
    dropzone.addEventListener('click', ()=> fileInput.click());
    dropzone.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') fileInput.click(); });

    fileInput.addEventListener('change', (e) => {
      const f = e.target.files[0];
      if (f) handleFileSelection(f);
    });

    function handleFileSelection(file) {
      currentFile = file;
      const reader = new FileReader();
      reader.onload = (ev) => {
        preview.src = ev.target.result;
        preview.hidden = false;
      };
      reader.readAsDataURL(file);
      notesEl.textContent = 'File ready. Click Predict to run inference.';
    }

    function clearAll() {
      currentFile = null;
      fileInput.value = '';
      preview.src = '';
      preview.hidden = true;
      outcomeEl.textContent = '—';
      confidenceEl.textContent = '0%';
      progressBar.style.width = '0%';
      notesEl.textContent = 'No analysis yet. Upload an MRI to begin.';
    }

    function animateConfidence(targetPct) {
      const target = Math.max(0, Math.min(100, Number(targetPct)));
      const duration = 900;
      const stepMs = 30;
      const steps = Math.ceil(duration / stepMs);
      let current = 0;
      const stepVal = target / steps;
      progressBar.style.width = '0%';
      return new Promise(resolve => {
        const id = setInterval(() => {
          current += stepVal;
          if (current >= target - 0.0001) {
            current = target;
            clearInterval(id);
          }
          confidenceEl.textContent = current.toFixed(2) + '%';
          progressBar.style.width = current.toFixed(2) + '%';
          if (current === target) resolve();
        }, stepMs);
      });
    }

    /* ---------- Upload & predict ---------- */
    async function uploadImage() {
      if (!currentFile) {
        alert('Please choose or drop an MRI image first.');
        return;
      }

      predictBtn.disabled = true;
      clearBtn.disabled = true;
      overlay.style.display = 'flex';
      overlay.setAttribute('aria-hidden', 'false');
      overlayMsg.textContent = 'Uploading image & running model inference...';

      try {
        const fd = new FormData();
        fd.append('file', currentFile);

        const resp = await fetch('http://127.0.0.1:8000/predict', { method: 'POST', body: fd });
        if (!resp.ok) throw new Error('Server error: ' + resp.status);

        const data = await resp.json();
        const pred = data.prediction || 'Unknown';
        const confRaw = (typeof data.confidence !== 'undefined') ? Number(data.confidence) * 100 : (data.confidence_pct || 0);
        const conf = isNaN(confRaw) ? 0 : confRaw;

        outcomeEl.textContent = pred;
        notesEl.textContent = data.note || 'Model inference completed. Use with clinical judgment.';

        await new Promise(r => setTimeout(r, 220));
        await animateConfidence(conf);
      } catch (err) {
        console.error(err);
        alert('Prediction failed: ' + (err.message || err));
        notesEl.textContent = 'Prediction failed. See console for details.';
      } finally {
        overlay.style.display = 'none';
        overlay.setAttribute('aria-hidden', 'true');
        predictBtn.disabled = false;
        clearBtn.disabled = false;
      }
    }

    /* init */
    clearAll();
  </script>
</body>
</html>
